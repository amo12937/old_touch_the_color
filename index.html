<html>
<head>
<style>
.board {
  display: flex;
  flex-direction: column;
  height: 480px;
  width: 480px;
}

.row {
  display: flex;
  flex-direction: row;
  flex: auto;
}

.item {
  flex: auto;
  margin: 3px;
  border-radius: 10px;
  background-color: #ffcccc;
}
</style>
<script>
model = (function(){
  var ITEMS = 9;
  var HINTS = 4;
  var r = function(n) {
    return Math.floor(Math.random() * n);
  };

  var other = function(n, k) {
    var s = r(n - 1);
    if (s < k)
      return s;
    else
      return s + 1;
  }

  var observee = function() {
    var i = 0;
    var listeners = {}
    return {
      "addObserver": function (fn) {
        listeners[i] = fn;
        var del = (function(j) {
          return function() {
            delete listeners[j];
          }
        })(i);
        i += 1;
        return del;
      },
      "notify": function(x) {
        for (i in listeners) {
          listeners[i](x);
        }
      }
    };
  };

  var f = function(n, m) {
    var s = [r(n)];
    var i = 0;
    for (i = 1; i < m; i++) {
      s[i] = other(n, s[i-1]);
    }
    var o = observee();

    self = {
      "addObserver": function (fn) {
        o.addObserver(fn);
      },
      "shift": function(j) {
        if (s[0] !== j) {
          return;
        }
        s.push(other(n, s[m-1]));
        s.shift();
        o.notify(self.get());
      },
      "get": function() {
        return s.slice(0);
      },
    };
    return self;
  }

  return f(ITEMS, HINTS);
})()

controller = (function(m) {
  return function(j) {
    m.shift(j);
  };
})(model);

view = (function(m) {
  var add1 = function(n) { return n + 1; };
  return function (elm) {
    m.addObserver(function(s) {
      elm.innerHTML = s.map(add1).toString();
    });
    elm.innerHTML = m.get().map(add1).toString();
  };
})(model);

onLoad = function(d) {
  var hintElm = d.getElementById("hints");
  view(hintElm);
};

</script>
</head>
<body onload="onLoad(document)">
<div id="hints"></div>
<br>
<div class="board">
  <div class="row">
    <div class="item" onclick="controller(0)">1</div>
    <div class="item" onclick="controller(1)">2</div>
    <div class="item" onclick="controller(2)">3</div>
  </div>
  <div class="row">
    <div class="item" onclick="controller(3)">4</div>
    <div class="item" onclick="controller(4)">5</div>
    <div class="item" onclick="controller(5)">6</div>
  </div>
  <div class="row">
    <div class="item" onclick="controller(6)">7</div>
    <div class="item" onclick="controller(7)">8</div>
    <div class="item" onclick="controller(8)">9</div>
  </div>
</div>
</body>
</html>
