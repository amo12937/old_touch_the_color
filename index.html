<html>
<head>
<script>
model = (function(){
  var ITEMS = 9;
  var HINTS = 4;
  var r = function(n) {
    return Math.floor(Math.random() * n);
  };

  var other = function(n, k) {
    var s = r(n - 1);
    if (s < k)
      return s;
    else
      return s + 1;
  }

  var observee = function() {
    var i = 0;
    var listeners = {}
    return {
      "addObserver": function (fn) {
        listeners[i] = fn;
        var del = (function(j) {
          return function() {
            delete listeners[j];
          }
        })(i);
        i += 1;
        return del;
      },
      "notify": function(x) {
        for (i in listeners) {
          listeners[i](x);
        }
      }
    };
  };

  var f = function(n, m) {
    var s = [r(n)];
    var i = 0;
    for (i = 1; i < m; i++) {
      s[i] = other(n, s[i-1]);
    }
    var o = observee();

    self = {
      "addObserver": function (fn) {
        o.addObserver(fn);
      },
      "shift": function(j) {
        if (s[0] !== j) {
          return;
        }
        s.push(other(n, s[m-1]));
        s.shift();
        o.notify(self.get());
      },
      "get": function() {
        return s.slice(0);
      },
    };
    return self;
  }

  return f(ITEMS, HINTS);
})()

controller = (function(m) {
  return function(j) {
    m.shift(j);
  };
})(model);

view = (function(m) {
  var add1 = function(n) { return n + 1; };
  return function (elm) {
    m.addObserver(function(s) {
      elm.innerHTML = s.map(add1).toString();
    });
    elm.innerHTML = m.get().map(add1).toString();
  };
})(model);

onLoad = function(d) {
  var hintElm = d.getElementById("hints");
  view(hintElm);
};

</script>
</head>
<body onload="onLoad(document)">
<div id="hints"></div>
<br>
<button id="button1" onclick="controller(0)">1</button>
<button id="button2" onclick="controller(1)">2</button>
<button id="button3" onclick="controller(2)">3</button>
<br>
<button id="button4" onclick="controller(3)">4</button>
<button id="button5" onclick="controller(4)">5</button>
<button id="button6" onclick="controller(5)">6</button>
<br>
<button id="button7" onclick="controller(6)">7</button>
<button id="button8" onclick="controller(7)">8</button>
<button id="button8" onclick="controller(8)">9</button>
</body>
</html>
